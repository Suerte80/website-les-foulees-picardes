{# templates/files/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Gestion des fichiers{% endblock %}

{% block body %}

            <section class="section-card bg-white space-y-6">

                {# Header + actions #}
                <header class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                    <h1 class="m-0">Gestion des fichiers</h1>

                    <nav class="flex flex-wrap items-center gap-2">
                        {% if prev_dir_id is defined and prev_dir_id is not null %}
                            <a href="{{ path('app_files_list_dir', {id: prev_dir_id}) }}" class="btn btn-secondary btn-sm">‚Üê Pr√©c√©dent</a>
                        {% else %}
                            <a href="{{ path('app_files_list') }}" class="btn btn-secondary btn-sm">‚Üê Pr√©c√©dent</a>
                        {% endif %}
                        <a href="{{ path('app_files_list') }}" class="btn btn-secondary btn-sm">‚ü≤ Racine</a>

                        {# Lien upload (m√™me place que la nav pour l‚Äôavoir sous la main) #}
                        {% if parent is defined and parent is not null %}
                            <a href="{{ path('app_files_upload', {id: parent.id}) }}" class="btn btn-primary btn-sm">üì§ T√©l√©verser</a>
                        {% else %}
                            <a href="{{ path('app_files_upload') }}" class="btn btn-primary btn-sm">üì§ T√©l√©verser</a>
                        {% endif %}
                    </nav>
                </header>

                {# Tableau #}
                <div class="overflow-x-auto rounded-lg">
                    <table class="table min-w-full">
                        <thead>
                        <tr>
                            <th class="w-[45%]">Nom</th>
                            <th class="w-[15%]">Taille</th>
                            <th class="w-[20%]">Cr√©√© le</th>
                            <th class="w-[20%] text-right">Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for file in files %}
                            <tr>
                                {% if file.isFile %}
                                    <td>
                                        <a class="link" href="{{ path('app_files_download', {id: file.id}) }}">üìÑ {{ file.name }}</a>
                                    </td>
                                    <td>{{ file.size }} Octets</td>
                                    <td>{{ file.createdAt|date('d/m/Y') }}</td>
                                    <td class="text-right">
                                        <form action="{{ path('app_files_delete', {id: file.id}) }}" method="POST" class="inline-block">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete_dir') }}">
                                            <input type="hidden" name="_method" value="delete">
                                            <input type="hidden" name="id" value="{{ file.id }}">
                                            <button type="submit" class="btn btn-cancel btn-sm">Supprimer</button>
                                        </form>
                                    </td>
                                {% elseif file.isFolder %}
                                    <td>
                                        <a class="link" href="{{ path('app_files_list_dir', {id: file.id}) }}">üìÅ {{ file.name }}</a>
                                    </td>
                                    <td>DIR</td>
                                    <td>{{ file.createdAt|date('d/m/Y') }}</td>
                                    <td class="text-right">
                                        <form action="{{ path('app_files_delete', {id: file.id}) }}" method="POST" class="inline-block">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete_dir') }}">
                                            <input type="hidden" name="_method" value="delete">
                                            <input type="hidden" name="id" value="{{ file.id }}">
                                            <button type="submit" class="btn btn-cancel btn-sm">Supprimer</button>
                                        </form>
                                    </td>
                                {% endif %}
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="4">
                                    <div class="info-box">
                                        <details class="info-box" open>
                                            <summary>
                                                <h3 class="m-0">Aucun fichier</h3>
                                                <span class="info-box__chev">‚Ä∫</span>
                                            </summary>
                                            <div class="info-box__body">
                                                <p>Il n‚Äôy a encore rien ici. Cr√©e un dossier ou t√©l√©verse un fichier pour commencer.</p>
                                                <div class="flex flex-wrap gap-2">
                                                    {% if parent is defined and parent is not null %}
                                                        <a href="{{ path('app_files_upload', {id: parent.id}) }}" class="btn btn-primary btn-sm">üì§ T√©l√©verser un fichier</a>
                                                    {% else %}
                                                        <a href="{{ path('app_files_upload') }}" class="btn btn-primary btn-sm">üì§ T√©l√©verser un fichier</a>
                                                    {% endif %}
                                                    <a id="create-dir-button" href="#create-dir" class="btn btn-secondary btn-sm">Ôºã Cr√©er un dossier</a>
                                                </div>
                                            </div>
                                        </details>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                {# Cr√©ation de dossier #}
                <section id="create-dir" class="rounded-xl border border-amber-800/20 bg-white/70 p-4 sm:p-6">
                    <h3 class="mb-3">Cr√©er un dossier {% if parent is defined and parent is not null %}dans ¬´ {{ parent.name }} ¬ª{% else %}√† la racine{% endif %}</h3>
                    <form id="create-form-dir" action="{{ path('app_files_create_directory') }}" method="post" class="grid gap-3 sm:grid-cols-[1fr_auto]" data-ajax>
                        <input type="hidden" name="_token" value="{{ csrf_token('create_dir_root') }}">
                        {% if parent is defined and parent is not null %}
                            <input type="hidden" name="parent_id" value="{{ parent.id }}">
                        {% endif %}

                        <label class="sr-only" for="name_root">Nom</label>
                        <input
                            class="rounded-lg border border-amber-800/20 bg-white px-4 py-2 outline-none focus:ring-4 focus:ring-brand/30"
                            type="text" id="name_root" name="name" placeholder="Nouveau dossier" required>
                        <button type="submit" class="btn btn-secondary">Cr√©er</button>
                    </form>
                </section>

            </section>

{% endblock %}
